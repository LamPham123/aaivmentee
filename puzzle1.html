<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stage 1 â€” Cipher | Who Am I?</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .hint-bar {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .hint-label {
      font-family: 'Orbitron', sans-serif;
      font-size: 0.75rem;
      letter-spacing: 0.15em;
      color: var(--accent);
      text-transform: uppercase;
      white-space: nowrap;
    }

    .hint-images {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }

    .hint-img-wrap {
      width: 140px;
      height: 140px;
      border: 1px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
      background: #0d1117;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .hint-img-wrap img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .hint-plus {
      color: var(--muted);
      font-size: 1.2rem;
      font-weight: bold;
      flex-shrink: 0;
    }

    /* Pigpen message display */
    .message-wrap {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: flex-end;
      justify-content: center;
      padding: 20px 10px;
      background: #0d1117;
      border: 1px solid var(--border);
      border-radius: 10px;
      margin: 16px 0;
    }

    .pp-symbol {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      flex-shrink: 0;
    }

    .pp-symbol svg {
      width: 28px;
      height: 28px;
      overflow: visible;
    }

    .word-gap {
      width: 18px;
      height: 36px;
      flex-shrink: 0;
    }
  </style>
</head>
<body>
  <div class="container">

    <header class="site-header">
      <p class="stage-label">Stage 1 of 5</p>
      <h1 class="title">THE CIPHER</h1>
      <h2 class="subtitle">Decode the message. Find the clue.</h2>
    </header>

    <div class="progress-wrap">
      <div class="progress-label"><span>Progress</span><span>1 / 5</span></div>
      <div class="progress-bar"><div class="progress-fill" style="width: 20%"></div></div>
    </div>

    <div class="step-dots">
      <div class="dot active"></div>
      <div class="dot"></div>
      <div class="dot"></div>
      <div class="dot"></div>
      <div class="dot"></div>
    </div>

    <!-- Hint -->
    <div class="panel">
      <p class="panel-title">Look Up:</p>
      <div class="hint-bar">
        <div class="hint-images">
          <div class="hint-img-wrap">
            <img src="pig.png" alt="pig" />
          </div>
          <span class="hint-plus">+</span>
          <div class="hint-img-wrap">
            <img src="pen.png" alt="pen" />
          </div>
          <span class="hint-plus">+</span>
          <div class="hint-img-wrap">
            <img src="cypher.png" alt="cypher" />
          </div>
        </div>
      </div>
    </div>

    <!-- Encoded Message -->
    <div class="panel">
      <p class="panel-title">Encoded Message</p>
      <p class="dim">Decode the symbols below. Enter the full phrase to proceed.</p>
      <div class="message-wrap" id="message"></div>
    </div>

    <!-- Answer -->
    <div class="panel">
      <p class="panel-title">Your Answer</p>
      <div class="answer-section">
        <label class="answer-label" for="ans">Enter the decoded phrase</label>
        <input
          class="answer-input"
          id="ans"
          type="text"
          placeholder="TYPE THE DECODED MESSAGE..."
          autocomplete="off"
          spellcheck="false"
          maxlength="60"
        />
        <div class="feedback" id="fb"></div>
        <button class="btn" onclick="checkAnswer()">SUBMIT</button>
      </div>
    </div>

    <!-- Success -->
    <div class="success-banner" id="success">
      <p class="big">âœ“ &nbsp; CORRECT!</p>
      <p style="color:var(--text); margin-bottom:16px">
        First clue unlocked. Keep going.
      </p>
      <a href="puzzle2.html" class="btn">NEXT STAGE â†’</a>
    </div>

  </div>

  <script>
  /*
   * â”€â”€ Pigpen cipher symbol definitions â”€â”€
   * Each letter maps to a set of SVG line paths in a 20Ã—20 viewBox.
   * Grid 1 (Aâ€“I, no dot): walls around each cell of a 3Ã—3 grid.
   * Grid 2 (Jâ€“R, dot):    same shapes + a dot at center.
   * X set  (Sâ€“V, no dot): portions of an X shape.
   * X set  (Wâ€“Z, dot):    same X portions + dot.
   *
   * Wall key (20Ã—20 box):
   *   top    = "M 0,0 L 20,0"
   *   bottom = "M 0,20 L 20,20"
   *   left   = "M 0,0 L 0,20"
   *   right  = "M 20,0 L 20,20"
   *
   * X portions (lines from center 10,10 to corners):
   *   S = âˆ§  â†’ (10,10)â†’(0,0)  + (10,10)â†’(20,0)   top chevron
   *   T = >  â†’ (10,10)â†’(20,0) + (10,10)â†’(20,20)  right chevron
   *   U = âˆ¨  â†’ (10,10)â†’(0,20) + (10,10)â†’(20,20)  bottom chevron
   *   V = <  â†’ (10,10)â†’(0,0)  + (10,10)â†’(0,20)   left chevron
   */

  const T = 'M 0,0 L 20,0';    // top
  const B = 'M 0,20 L 20,20';  // bottom
  const L = 'M 0,0 L 0,20';    // left
  const R = 'M 20,0 L 20,20';  // right

  const PIGPEN = {
    // â”€â”€ Grid 1 (Aâ€“I, no dot) â”€â”€
    // A = right + bottom  (top-left cell)
    A: { p: [R, B] },
    // B = left + right + bottom  (top-center)
    B: { p: [L, R, B] },
    // C = left + bottom  (top-right)
    C: { p: [L, B] },
    // D = top + right + bottom  (middle-left)
    D: { p: [T, R, B] },
    // E = all 4  (center)
    E: { p: [T, R, B, L] },
    // F = top + left + bottom  (middle-right)
    F: { p: [T, L, B] },
    // G = top + right  (bottom-left)
    G: { p: [T, R] },
    // H = top + left + right  (bottom-center)
    H: { p: [T, L, R] },
    // I = top + left  (bottom-right)
    I: { p: [T, L] },

    // â”€â”€ Grid 2 (Jâ€“R, dot) â”€â”€
    J: { p: [R, B],       d: true },
    K: { p: [L, R, B],    d: true },
    L: { p: [L, B],       d: true },
    M: { p: [T, R, B],    d: true },
    N: { p: [T, R, B, L], d: true },
    O: { p: [T, L, B],    d: true },
    P: { p: [T, R],       d: true },
    Q: { p: [T, L, R],    d: true },
    R: { p: [T, L],       d: true },

    // â”€â”€ X set (Sâ€“V, no dot) â”€â”€
    // S = top chevron  âˆ§
    S: { p: ['M 10,10 L 0,0', 'M 10,10 L 20,0'] },
    // T = left chevron  <
    T: { p: ['M 10,10 L 0,0', 'M 10,10 L 0,20'] },
    // U = bottom chevron  âˆ¨
    U: { p: ['M 10,10 L 0,20', 'M 10,10 L 20,20'] },
    // V = bottom chevron  âˆ¨
    V: { p: ['M 10,10 L 0,20', 'M 10,10 L 20,20'] },

    // â”€â”€ X set (Wâ€“Z, dot) â”€â”€
    W: { p: ['M 10,10 L 0,0',  'M 10,10 L 20,0'],  d: true },
    X: { p: ['M 10,10 L 0,0', 'M 10,10 L 20,20'], d: true },
    Y: { p: ['M 10,10 L 20,0', 'M 10,10 L 20,20'], d: true, cx: 20 },
    Z: { p: ['M 10,10 L 0,20', 'M 10,10 L 20,20'], d: true }
  };

  function makeSvg(letter) {
    const def = PIGPEN[letter];
    if (!def) return null;
    const ns = 'http://www.w3.org/2000/svg';
    const svg = document.createElementNS(ns, 'svg');
    svg.setAttribute('viewBox', '-2 -2 24 24');
    svg.setAttribute('width', '28');
    svg.setAttribute('height', '28');

    def.p.forEach(d => {
      const path = document.createElementNS(ns, 'path');
      path.setAttribute('d', d);
      path.setAttribute('stroke', '#22d3a0');
      path.setAttribute('stroke-width', '2.2');
      path.setAttribute('stroke-linecap', 'round');
      path.setAttribute('fill', 'none');
      svg.appendChild(path);
    });

    if (def.d) {
      const circle = document.createElementNS(ns, 'circle');
      circle.setAttribute('cx', def.cx !== undefined ? String(def.cx) : '10');
      circle.setAttribute('cy', def.cy !== undefined ? String(def.cy) : '10');
      circle.setAttribute('r', '2');
      circle.setAttribute('fill', '#22d3a0');
      svg.appendChild(circle);
    }

    return svg;
  }

  // â”€â”€ Render the message â”€â”€
  // "MY MENTOR IS SO LOVING"
  const MESSAGE = 'MY MENTOR IS SO LOVING';
  const container = document.getElementById('message');

  MESSAGE.split('').forEach(ch => {
    if (ch === ' ') {
      const gap = document.createElement('div');
      gap.className = 'word-gap';
      container.appendChild(gap);
    } else {
      const wrap = document.createElement('div');
      wrap.className = 'pp-symbol';
      const svg = makeSvg(ch);
      if (svg) wrap.appendChild(svg);
      container.appendChild(wrap);
    }
  });

  // â”€â”€ Answer check â”€â”€
  let tries = 0;
  const ANSWER = 'MY MENTOR IS SO LOVING';

  function checkAnswer() {
    const raw = document.getElementById('ans').value.trim().toUpperCase();
    const fb  = document.getElementById('fb');
    const inp = document.getElementById('ans');

    if (!raw) return;

    // Normalize: strip extra spaces, compare
    const normalized = raw.replace(/\s+/g, ' ');

    if (normalized === ANSWER) {
      inp.classList.remove('wrong');
      inp.classList.add('correct');
      inp.setAttribute('readonly', true);
      fb.className = 'feedback ok';
      fb.textContent = 'âœ“ Decoded correctly!';
      document.getElementById('success').classList.add('show');
      document.querySelector('.btn[onclick="checkAnswer()"]').style.display = 'none';
    } else {
      tries++;
      inp.classList.add('wrong');
      setTimeout(() => inp.classList.remove('wrong'), 400);
      fb.className = tries >= 2 ? 'feedback hint' : 'feedback err';
      if (tries === 1) {
        fb.textContent = 'âœ— Not quite. Double-check your decoding.';
      } else if (tries === 2) {
        fb.textContent = 'ðŸ’¡ Hint: The phrase is 5 words long.';
      } else {
        fb.textContent = 'ðŸ’¡ Hint: Starts with "MY" â€” keep going.';
      }
    }
  }

  document.getElementById('ans').addEventListener('keydown', e => {
    if (e.key === 'Enter') checkAnswer();
  });
  </script>
</body>
</html>
